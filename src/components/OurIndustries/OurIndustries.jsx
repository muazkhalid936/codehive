'use client';

export const ourIndustriesData = [
  {
    title: 'Car Wash',
    atitle: 'غسيل السيارات',
    ades1:
      'ودّع الانتظار الطويل والزيارات غير المريحة لمحطات الغسيل! يتيح لك تطبيق غسيل السيارات حجز خدمات التنظيف الاحترافية بسهولة في أي وقت ومن أي مكان. بلمسات بسيطة، يمكنك تحديد موعد للغسيل، تتبع الخدمة، والاستمتاع بسيارة نظيفة دون الحاجة إلى مغادرة منزلك.',
    ades2:
      'سواء كنت بحاجة إلى تنظيف خارجي سريع أو عناية داخلية شاملة، يضمن لك محترفونا الموثوقون خدمة عالية الجودة باستخدام منتجات صديقة للبيئة. استمتع بتجربة عناية بالسيارة خالية من المتاعب مع عملية حجز سلسة، مدفوعات آمنة، وتحديثات فورية – كل ذلك في تطبيق سهل الاستخدام!.',
    des1: 'Say goodbye to long waits and inconvenient trips to the car wash! Our car wash app makes it easy to book professional cleaning services anytime, anywhere. With just a few taps, you can schedule a wash, track your service, and enjoy a spotless car without leaving your home.',
    des2: 'Whether you need a quick exterior clean or a full interior detail, our trusted professionals ensure top-quality care using eco-friendly products. Experience hassle-free car care with a seamless booking process, secure payments, and real-time updates—all in one easy-to-use app!',
    link: '/industries/car-wash',
  },
  {
    title: 'Delivery',
    atitle: 'التوصيل',
    link: '/industries/delivery',
    des1: ' This delivery app streamlines the entire shipping process with a focus on speed, reliability, and convenience.',
    ades1:
      ' يعمل هذا التطبيق على تبسيط عملية الشحن بالكامل مع التركيز على السرعة، الموثوقية، والراحة.',
    des2: 'Easily schedule pickups, track your deliveries in real-time, and get instant updates on your shipments. Our app offers services like same-day delivery, scheduled deliveries, and secure handling of all types of items, ensuring a seamless experience.',
    ades2:
      'حدد موعدًا لاستلام شحنتك بسهولة، تتبعها في الوقت الفعلي، واحصل على تحديثات فورية حول حالتها. يوفر تطبيقنا خدمات مثل التوصيل في نفس اليوم، الشحن المجدول، والتعامل الآمن مع جميع أنواع الطرود لضمان تجربة سلسة.',
    des3: 'With user-friendly interface, you can manage deliveries on the go, choose the best service for your needs, and enjoy fast, efficient shipping without the hassle. We’re committed to making your delivery experience smooth, reliable, and stress-free',
    ades3:
      'بواجهة استخدام سهلة، يمكنك إدارة عمليات التوصيل أثناء التنقل، اختيار الخدمة الأنسب لاحتياجاتك، والاستمتاع بشحن سريع وفعال دون أي متاعب. نحن ملتزمون بجعل تجربة التوصيل الخاصة بك سلسة، موثوقة، وخالية من القلق.',
  },
  {
    title: 'Health Care',
    atitle: 'الرعاية الصحية',
    link: '/industries/health-care',
    des1: 'Our healthcare solutions are built to enhance efficiency and improve patient care for clinics, hospitals, and medical centres.',
    ades1:
      'تم تصميم حلولنا الصحية لتعزيز الكفاءة وتحسين رعاية المرضى للمستشفيات، العيادات، والمراكز الطبية.',
    des2: 'Manage appointments, patient records, and billing seamlessly with secure, fully compliant systems. Enable telemedicine, real-time consultations, and instant access to health records for a better patient experience.',
    ades2:
      'يمكنك إدارة المواعيد، سجلات المرضى، والفواتير بسهولة عبر أنظمة آمنة ومتوافقة تمامًا مع المعايير الصحية. كما يمكنك تمكين خدمات التطبيب عن بعد، الاستشارات الفورية، والوصول السريع إلى السجلات الطبية لتحسين تجربة المرضى.',
    des3: 'Use advanced analytics to track trends, optimize workflows, and streamline operations. With our scalable and easy-to-use solutions, you can elevate your healthcare services and deliver exceptional care.',
    ades3:
      'استفد من التحليلات المتقدمة لمتابعة الاتجاهات، تحسين سير العمل، وتبسيط العمليات. بفضل حلولنا القابلة للتوسع وسهلة الاستخدام، يمكنك الارتقاء بخدماتك الصحية وتقديم رعاية استثنائية.',
  },
  // {
  //   title: "Booking",
  //   link: "/industries/our-booking-system",
  //   des1: "Simplify your reservations with our user-friendly booking platform. From hotels to events, we’ve made it easier than ever to secure your spot.",
  //   des2: "Enjoy real-time availability checks and instant confirmations that save you time and effort.",
  //   des3: "Our transparent pricing ensures there are no hidden surprises, giving you peace of mind.",
  //   des4: "Let us handle the details while you focus on enjoying your experience. Seamless booking, tailored to your needs.",
  //   image: "/Industry/4.png",
  // },
  {
    title: 'Ecommerce',
    atitle: 'التجارة الإلكترونية',
    link: '/industries/ecommerce',
    des1: 'Our ecommerce platform is built to help businesses grow, offering a seamless and efficient online shopping experience.',
    ades1:
      'منصتنا للتجارة الإلكترونية مصممة لدعم نمو الأعمال من خلال تقديم تجربة تسوق سلسة وفعالة عبر الإنترنت.',
    des2: 'Easily manage products, track inventory in real-time, and optimize sales with personalized recommendations. Our secure payment processing and streamlined checkout ensure smooth transactions for your customers.',
    ades2:
      'يمكنك بسهولة إدارة المنتجات، تتبع المخزون في الوقت الفعلي، وزيادة المبيعات من خلال التوصيات المخصصة. تضمن عمليات الدفع الآمنة وخطوات الشراء المبسطة تجربة تسوق مريحة للعملاء.',
    des3: "With a mobile-first design, advanced analytics, and built-in marketing tools, you can enhance engagement, boost conversions, and stay ahead of the competition. Whether you're a small business or a large enterprise, we provide the solutions you need to scale with confidence.",
    ades3:
      'بفضل التصميم المتوافق مع الهواتف الذكية، التحليلات المتقدمة، وأدوات التسويق المدمجة، يمكنك تعزيز التفاعل، زيادة معدلات التحويل، والبقاء في المقدمة. سواء كنت شركة ناشئة أو مؤسسة كبيرة، نوفر لك الحلول التي تحتاجها للتوسع بثقة.',
  },
  {
    title: 'Fitness',
    atitle: 'اللياقة البدنية',
    link: '/industries/fitness',
    des1: 'Enhance the fitness experience with smart digital solutions tailored for gyms, trainers, and wellness platforms.',
    ades1:
      'ارتقِ بتجربة اللياقة البدنية من خلال حلول رقمية ذكية مصممة خصيصًا للصالات الرياضية، المدربين، ومنصات العافية.',
    des2: 'Provide users with personalized workout plans, progress tracking, and guided exercise demonstrations to keep them engaged. Integrate wearable devices and nutrition tracking for a holistic approach to fitness.',
    ades2:
      'وفّر للمستخدمين خطط تمارين مخصصة، تتبع التقدم، وعروض تمارين إرشادية للحفاظ على تفاعلهم وتحفيزهم.',
    des3: 'Simplify class scheduling, membership management, and payments with seamless automation. With data-driven insights and an intuitive interface, our solutions help you build a strong, loyal fitness community.',
    ades3:
      'بسط عمليات جدولة الحصص، إدارة الاشتراكات، والمدفوعات عبر أتمتة سلسة. من خلال التحليلات المستندة إلى البيانات وواجهة الاستخدام الذكية، تساعدك حلولنا على بناء مجتمع رياضي قوي ومخلص.',
  },
];

import { useEffect, useRef, useState, lazy, Suspense } from 'react';
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { FiArrowUpRight } from 'react-icons/fi';
import { Canvas } from '@react-three/fiber';
import dynamic from 'next/dynamic';
import useStore from '../../store/useUserStore';
import { useRouter } from 'next/navigation';
import { Link } from '../../i18n/routing';
import { useTranslations } from 'next-intl';

gsap.registerPlugin(ScrollTrigger);

// Lazy load the IphoneModel component
const IphoneModel = dynamic(() => import('../IphoneModel'), { ssr: false });

const ScrollAnimation = () => {
  const router = useRouter();
  const t = useTranslations("translation");
  const [activeSection, setActiveSection] = useState(0);

  const texturePaths = [
    '/iphoneModel/Car wash.jpg',
    '/iphoneModel/Delivery.png',
    '/iphoneModel/Health Care.jpg',
    '/iphoneModel/Ecommerce.jpg',
    '/iphoneModel/Fitness.png',
  ];

  const containerRef = useRef();
  const isInViewRef = useRef(false);
  const [textureUrl, setTextureUrl] = useState(texturePaths[0]);
  const meshRef = useRef();
  const imageObjectsRef = useRef([]);

  const { language } = useStore();

  useEffect(() => {
    // Preload images and store them in a ref
    imageObjectsRef.current = texturePaths.map((path) => {
      const img = new Image();
      img.src = path;
      return img;
    });

    const sections = containerRef.current.querySelectorAll('.section');

    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: containerRef.current,
        start: 'top top',
        end: '+=5000',
        scrub: 1,
        pin: true,
        toggleActions: 'play none none none',
        onUpdate: (self) => {
          const currentSectionIndex = Math.floor(self.progress * sections.length);
          setActiveSection(currentSectionIndex);
        },
      },
    });

    sections.forEach((section, index) => {
      const heading = section.querySelector('.heading');

      if (index === 0) {
        tl.fromTo(
          heading,
          { x: 150, opacity: 0 },
          { x: 0, opacity: 1, duration: 0.5 },
          0
        );
        tl.fromTo(
          '.iphone',
          { x: -150, opacity: 0 },
          { x: 0, opacity: 1, duration: 0.2 },
          0
        );
      }
      if (index > 0) {
        tl.to(
          sections[index - 1].querySelector('.heading'),
          { x: -50, opacity: 0, duration: 0.5 },
          index
        );

        tl.fromTo(
          heading,
          { x: 50, opacity: 0 },
          { x: 0, opacity: 1, duration: 0.5 },
          index + 0.5
        );

        const startRotation = 5;
        const endRotation = 11.3;
        const midRotation = (startRotation + endRotation) / 2;

        tl.to(
          {},
          {
            onUpdate: () => {
              const sectionProgress = tl.progress() * sections.length - index;
              const rotationValue = gsap.utils.interpolate(
                startRotation,
                endRotation,
                sectionProgress
              );

              if (meshRef.current) {
                meshRef.current.rotation.y = rotationValue;
              }

              if (Math.abs(rotationValue - midRotation) < 0.4) {
                setTextureUrl(texturePaths[index]);
              } else if (Math.abs(rotationValue) < 7.8) {
                setTextureUrl(texturePaths[index - 1]);
              }
            },
            ease: 'none',
          },
          index + 0.2
        );
      }
    });

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          isInViewRef.current = entry.isIntersecting;
        });
      },
      { threshold: 0.1 }
    );

    if (containerRef.current) {
      observer.observe(containerRef.current);
    }

    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
      gsap.globalTimeline.clear();
      if (containerRef.current) {
        observer.unobserve(containerRef.current);
      }
    };
  }, []);

  const canvasStyle = {
    height: '50vh',
    '@media (max-width: 480px)': {
      height: '300px',
    },
  };

  return (
    <div>
      <div
        ref={containerRef}
        className="flex flex-col container items-center justify-center mt-[-300px] h-[100vh] min-h-[400px] main22"
      >
        {ourIndustriesData.map((item, index) => (
          <div
            key={index}
            className="section absolute flex flex-col sm:flex-row-reverse justify-end items-end sm:items-center sm:justify-between sm:gap-8 px-16"
            style={{
              pointerEvents: activeSection === index ? 'auto' : 'none',
              zIndex: activeSection === index ? 1 : 0,
            }}
          >
            <div className="sm:w-[640px] text-center sm:text-start flex-1 heading" dir={language === 'en' ? 'ltr' : 'rtl'}>
              <div className="flex justify-center sm:justify-start">
                <p className="font-bold bg-gradient-to-r from-white via-blueColor to-blueColor bg-clip-text text-transparent main-heading text-[20px] sm:text-3xl md:text-5xl xl:text-6xl">
                  {language === 'en' ? item.title : item.atitle}
                </p>
              </div>
              <p className="mt-4 main_hero_slogan text-white">
                {language === 'en' ? item?.des1 : item?.ades1}
              </p>
              <p className="mt-4 text-white main_hero_slogan">
                {language === 'en' ? item?.des2 : item?.ades2}
              </p>
              <p className="mt-4 main_hero_slogan text-white">
                {language === 'en' ? item?.des3 : item?.ades3}
              </p>
              <p className="mt-4 main_hero_slogan text-white">
                {language === 'en' ? item?.des4 : item?.ades4}
              </p>
              <p className="mt-4 text-white main_hero_slogan">
                {language === 'en' ? item?.des5 : item?.ades5}
              </p>
              <div className="flex justify-center sm:justify-start items-center gap-3">
                <Link href={item.link} className="mt-2 xl:text-xl text-white">
                  {t("readMore9")}
                </Link>
                <div className="bg-white text-black mt-2 sm:mt-3 rounded-full">
                  <FiArrowUpRight className="text-sm sm:text-lg" />
                </div>
              </div>
            </div>

            <div className="sm:w-1/2 w-full iphone">
              <Canvas
                dpr={[1, 2]}
                camera={{ position: [25, 0, 0], fov: 50 }}
                className="canvas-container"
              >
                <Suspense fallback={null}>
                  <IphoneModel textureUrl={textureUrl} meshRef={meshRef} />
                </Suspense>
              </Canvas>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default ScrollAnimation;